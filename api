
document.addEventListener("DOMContentLoaded", () => {
  let current = 0;
  const steps = document.querySelectorAll(".step");
  const progress = document.getElementById("progress");
  const indicators = ["s1","s2","s3","s4"].map(id => document.getElementById(id));

  function showStep(i) {
    steps.forEach(step => step.classList.remove("active"));
    steps[i].classList.add("active");

    indicators.forEach(ind => ind.classList.remove("active"));
    indicators[i].classList.add("active");

    progress.style.width = (i / (steps.length - 1)) * 100 + "%";
  }

  document.querySelectorAll(".next-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      current = Math.min(current + 1, steps.length - 1);
      showStep(current);
    });
  });

  document.querySelectorAll(".back-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      current = Math.max(current - 1, 0);
      showStep(current);
    });
  });

  document.getElementById("appForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const data = Object.fromEntries(new FormData(e.target));

    const res = await fetch("/api/submit", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const result = await res.json();

    if (result.success) {
      document.getElementById("appForm").style.display = "none";
      document.getElementById("successBox").style.display = "block";
      document.getElementById("refID").innerText = result.reference;
      progress.style.width = "100%";
    } else {
      alert("Submission failed");
    }
  });
});
